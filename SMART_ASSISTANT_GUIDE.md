# 🤖 스마트 AI 어시스턴트 가이드

교회 데이터를 기반으로 한 스마트 AI 어시스턴트 시스템입니다. 사용자의 자연어 질문을 분석하여 관련 교회 데이터를 조회하고, 맥락에 맞는 구체적인 답변을 제공합니다.

## 📋 주요 기능

### 1. **심방 일정 관리**
- 오늘/내일/이번주 심방 일정 조회
- 심방 우선순위 및 긴급도 안내
- 방문 주소 및 특이사항 제공

### 2. **중보기도 요청 관리**
- 활성화된 기도제목 조회
- 긴급 기도 요청 우선 표시
- 기도 참여 현황 안내

### 3. **공지사항 요약**
- 최신 교회 소식 정리
- 중요 공지사항 우선 표시
- 카테고리별 분류 제공

### 4. **심방 보고서 분석**
- 최근 심방 현황 요약
- 방문 결과 및 특이사항 정리
- 후속 조치 필요사항 안내

## 🚀 API 엔드포인트

### 메인 쿼리 엔드포인트
```http
POST /api/v1/smart-assistant/query
```

**요청 예시:**
```json
{
  "message": "오늘 심방 일정 알려줘",
  "model": "gpt-4o-mini",
  "max_tokens": 2000,
  "temperature": 0.3
}
```

**응답 예시:**
```json
{
  "response": "오늘 심방 일정을 알려드립니다.\n\n1. **14:00 - 박은미 성도댁**\n   - 위치: 서울시 강남구 논현동 삼성서울병원 12층 1203호\n   - 유형: 병원 심방 (높은 우선순위)\n   - 내용: 어머님 입원으로 인한 위로 심방\n   - 연락처: 010-2345-6789\n   - 특이사항: 병실 직통전화 02-3410-1203\n\n2. **19:00 - 이정수 성도댁**\n   - 위치: 서울시 서초구 서초동 123-45 아파트 101동 503호\n   - 유형: 상담 심방 (일반 우선순위)\n   - 내용: 직장 문제 상담 및 격려\n   - 연락처: 010-3456-7890\n   - 특이사항: 평일 오후 7시 이후 연락 가능\n\n총 2건의 심방 일정이 있으며, 첫 번째 일정이 긴급도가 높으니 우선적으로 진행해 주시기 바랍니다.",
  "query_type": "pastoral_visit_schedule",
  "data_sources": ["pastoral_visits"],
  "tokens_used": 245,
  "model": "gpt-4o-mini",
  "success": true
}
```

### 의도 분석 엔드포인트
```http
POST /api/v1/smart-assistant/analyze
```

### 기능 목록 조회
```http
GET /api/v1/smart-assistant/capabilities
```

### 사용 통계 조회
```http
GET /api/v1/smart-assistant/usage-stats
```

## 💬 지원하는 질문 유형

### 심방 관련
```
"오늘 심방 일정 알려줘"
"내일 방문해야 할 곳 어디야?"
"이번주 심방 예정은?"
"긴급한 심방 요청 있나?"
```

### 기도 요청 관련
```
"최근 기도제목 뭐가 있어?"
"긴급 기도 요청 있나?"
"이번주 중보기도 내용"
"응답받은 기도제목 있어?"
```

### 공지사항 관련
```
"새로운 공지사항 있어?"
"이번주 중요한 안내사항"
"최근 교회 소식 정리해줘"
"고정된 공지 뭐가 있지?"
```

### 심방 보고서 관련
```
"최근 심방 결과 어때?"
"이번달 심방 보고서 요약"
"심방 현황 알려줘"
"어떤 곳들 방문했어?"
```

## 🔧 시스템 아키텍처

```
사용자 질문 
    ↓
🧠 의도 분석 (SmartAssistantService)
    ├── 심방 일정 → pastoral_care_requests 테이블
    ├── 기도 요청 → prayer_requests 테이블  
    ├── 공지사항 → announcements 테이블
    └── 심방 보고 → visits 테이블
    ↓
📊 데이터 수집 & 컨텍스트 빌드
    ↓
🤖 GPT API 호출 (맥락화된 프롬프트)
    ↓
✨ 구조화된 응답 생성
```

### 핵심 컴포넌트

1. **`SmartAssistantService`**: 메인 로직 처리
   - 질문 의도 분석
   - 데이터 수집 및 컨텍스트 구성
   - GPT 프롬프트 생성

2. **Query Intent Analysis**: 자연어 질문 분석
   - 키워드 기반 의도 분류
   - 시간 맥락 추출 (오늘, 내일, 이번주 등)
   - 신뢰도 점수 계산

3. **Context Data Builder**: 데이터 수집 및 구조화
   - 교회 데이터베이스 쿼리
   - 개인정보 필터링
   - JSON 형태 컨텍스트 생성

4. **Smart Prompt Builder**: GPT 프롬프트 최적화
   - 의도별 맞춤 지시사항
   - 구조화된 응답 템플릿
   - 교회 업무 특화 어조

## 🛡️ 보안 및 개인정보 보호

### 개인정보 보호
- 성도 개인정보는 요약 형태로만 제공
- 민감한 정보는 권한별 접근 제어
- 모든 데이터는 교회 내부에서만 사용

### API 보안
- JWT 토큰 기반 인증
- 교회별 데이터 분리
- GPT API 키 암호화 저장

### 사용량 관리
- 월별 토큰 사용량 모니터링
- 비용 추적 및 알림
- 사용량 한도 설정

## 🎯 사용 시나리오

### 시나리오 1: 목사님의 하루 일정 확인
**질문**: "오늘 하루 일정 알려줘"
**응답**: 심방 일정 + 중요 공지사항 + 긴급 기도 요청을 종합적으로 정리하여 제공

### 시나리오 2: 주보 작성을 위한 정보 수집
**질문**: "이번주 주보에 들어갈 내용 정리해줘"
**응답**: 새 공지사항 + 기도제목 + 교회 행사 일정을 카테고리별로 정리

### 시나리오 3: 심방 계획 수립
**질문**: "이번주 심방 계획 어떻게 세우면 좋을까?"
**응답**: 예정된 심방 + 우선순위 + 지역별 동선 최적화 제안

## ⚙️ 설정 및 커스터마이징

### GPT 모델 설정
```python
# 교회별 GPT 설정
church.gpt_model = "gpt-4o-mini"  # 또는 "gpt-4o"
church.max_tokens = 2000
church.temperature = 0.3  # 사실적 응답을 위한 낮은 온도
```

### 의도 분석 커스터마이징
```python
# 새로운 의도 패턴 추가
intent_patterns["custom_intent"] = [
    "커스텀 키워드1", "커스텀 키워드2"
]
```

### 프롬프트 템플릿 수정
```python
# 교회별 특성에 맞는 프롬프트 조정
system_prompt_template = """
당신은 {church_name} 교회의 AI 어시스턴트입니다.
...
"""
```

## 🔄 확장 계획

### 단기 (1-2개월)
- [ ] 외부 교회 데이터베이스 연동 강화
- [ ] 음성 인식 및 음성 응답 지원
- [ ] 모바일 앱 최적화

### 중기 (3-6개월)  
- [ ] 예측적 분석 (출석률 예측, 심방 우선순위 AI 추천)
- [ ] 다국어 지원 (영어, 중국어)
- [ ] 대화형 워크플로우 (연속 대화)

### 장기 (6개월+)
- [ ] 비전 AI (이미지 기반 질문 처리)
- [ ] 교회 특화 AI 모델 파인튜닝
- [ ] 타 교회와의 데이터 연동

## 🤝 기여 및 피드백

이 시스템은 계속 발전하고 있습니다. 사용 중 발견한 개선사항이나 새로운 기능 제안이 있으시면 언제든 공유해 주세요!

---

**개발팀**: Smart Yoram Backend Development Team  
**문의**: backend@smartyoram.com  
**버전**: 1.0.0  
**최종 업데이트**: 2024년 8월