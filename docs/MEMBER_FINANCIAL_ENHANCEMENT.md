# Smart Yoram 멤버 및 재정관리 기능 확장 분석서

## 개요

본 문서는 디모데 교회관리시스템의 테이블 구조를 분석하여 Smart Yoram 시스템에 필요한 멤버 관리 및 재정 관리 기능을 확장한 내용을 정리한 것입니다.

## 분석 결과 요약

### 1. 분석 대상 데이터
- **디모데_테이블 - 시트8.csv**: 교인 관리를 위한 종합적인 데이터베이스 구조
- **디모데_테이블 - 재정.csv**: 헌금 및 기부금 영수증 관리를 위한 데이터베이스 구조

### 2. 주요 확장 기능

#### A. 교인(Members) 관리 확장
기존 단순한 교인 정보에서 다음 기능들이 추가되었습니다:

**기본 정보 확장**:
- `code`: 교번 (내부 일련번호) - 각 교인의 고유 식별번호
- `name_eng`: 영문 이름 - 국제화 대응
- `age`: 나이 (캐시용) - 생년월일에서 자동 계산되는 나이
- `registration_background`: 등록 배경/경위 - 어떤 경로로 등록되었는지 기록

**관계 정보 확장**:
- `head_relationship`: 세대주와의 관계 - 가족 내에서의 역할 명확화
- `is_new_family_head`: 신앙세대주 여부 - 가족 중 신앙의 중심인지 표시
- `inviter1_member_id`, `inviter2_member_id`: 인도자 정보 - 누가 이 교인을 인도했는지 추적

**세부 관리 정보**:
- `photo_file_id`: 프로필 사진 파일 연결 - 기존 URL 방식에서 파일 관리 시스템 연동
- `memo`: 개인 특별사항 메모 - 교역자나 관리자가 기록하는 중요 정보

#### B. 관련 엔티티 추가

1. **연락처 관리 (MemberContact)**
   - 기존: 하나의 전화번호/이메일만 저장
   - 확장: 여러 연락처 (집전화, 휴대폰, 이메일 등) 분류하여 저장

2. **주소 관리 (Address, MemberAddress)**
   - 기존: 단순 문자열 주소
   - 확장: 구조화된 주소 (우편번호, 도로명주소, 상세주소, 행정구역)

3. **차량 정보 (MemberVehicle)**
   - 교회 주차장 관리 및 심방 시 차량 식별용

4. **사역 이력 (MemberMinistry)**
   - 직분 및 부서 배정 이력 관리
   - 임명일, 임직교회, 직장정보 등 상세 기록

5. **교회학교 이력 (MemberChurchSchool)**
   - 교회학교, 청년부 등의 소속 이력

6. **성례 기록 (Sacrament)**
   - 세례, 입교, 유아세례, 성찬 등의 성례 이력

7. **결혼 정보 (Marriage)**
   - 결혼 상태 및 배우자 정보 (교인인 경우 연결)

8. **이명/전출입 기록 (Transfer)**
   - 다른 교회로의 이동 이력 추적

9. **교육 및 신급 (EducationNote)**
   - 신급 교육 및 기타 교육 이력

10. **상태 변경 이력 (MemberStatusHistory)**
    - 등록, 휴면, 이명, 별세 등 상태 변경 이력 추적

#### C. 재정관리 시스템 신설

1. **기부자 관리 (Donor)**
   - 교인과 별도로 관리되는 기부자 정보
   - 개인정보보호를 위한 주민등록번호 암호화 저장
   - 교인이 아닌 외부 기부자도 관리 가능

2. **헌금 관리 (Offering)**
   - 헌금 유형별 관리 (십일조, 감사헌금, 건축헌금 등)
   - 기부자별, 날짜별 헌금 기록
   - 입력자 추적으로 책임 관리

3. **영수증 시스템 (Receipt, ReceiptItem, ReceiptSnapshot)**
   - 기부금 영수증 발급 및 관리
   - 연도별 일련번호 관리
   - 발급 시점의 정보 스냅샷 보관 (개인정보 변경에도 영수증 유효성 유지)

4. **헌금 유형 관리 (FundType)**
   - 교회별 맞춤 헌금 유형 설정
   - 활성/비활성 상태 관리

5. **재정 보고서 (FinancialReport)**
   - 월별, 연도별 재정 집계 보고서
   - JSON 형태의 유연한 데이터 저장

#### D. 심방 관리 시스템

1. **심방 기록 (Visit)**
   - 체계적인 심방 기록 관리
   - 찬송가 번호, 성경말씀, 심방 내용 기록

2. **심방 참여자 (VisitPeople)**
   - 심방자, 동행자, 대상자 역할별 관리
   - 교인이 아닌 외부인도 기록 가능

3. **일일사역보고 (DailyMinistryReport)**
   - 교역자의 일일 사역 계획 및 보고
   - 심방과 연결된 종합적 보고서

#### E. 시스템 관리 기능

1. **코드 관리 (Code)**
   - 직분, 부서, 구역, 심방구분 등 공통 코드
   - 교회별 맞춤 코드 설정 가능

2. **파일 관리 (File)**
   - 사진, 문서 등의 파일 통합 관리
   - 소유자별 분류 및 메타데이터 관리

3. **감사 로그 (AuditLog)**
   - 모든 중요 작업의 이력 추적
   - 변경 내용의 상세 기록

4. **검색 프리셋 (SearchPreset)**
   - 자주 사용하는 검색 조건 저장

5. **인쇄 작업 (PrintJob)**
   - 교적부, 구역 명단 등의 인쇄 작업 관리

6. **통계 스냅샷 (StatsSnapshot)**
   - 정기적인 통계 데이터 보관

## 구현 상세

### 1. 데이터베이스 모델 구조

#### 기존 Member 모델 확장
```python
# 새로 추가된 주요 필드들
code = Column(String, unique=True)  # 교번
name_eng = Column(String)  # 영문 이름
age = Column(Integer)  # 나이 (캐시용)
registration_background = Column(Text)  # 등록 배경
head_relationship = Column(String)  # 세대주와의 관계
is_new_family_head = Column(Boolean, default=False)  # 신앙세대주 여부
inviter1_member_id = Column(Integer, ForeignKey("members.id"))  # 인도자1
inviter2_member_id = Column(Integer, ForeignKey("members.id"))  # 인도자2
photo_file_id = Column(Integer, ForeignKey("files.id"))  # 프로필 사진
```

#### 교회 모델 확장
```python
# 재정 관리를 위한 추가 필드들
business_no = Column(String)  # 사업자등록번호
rrn_encrypted = Column(String)  # 주민등록번호 (암호화)
district_scheme = Column(String)  # 구역/교구 체계 명칭
```

### 2. API 엔드포인트

#### 재정 관리 API (`/api/v1/financial/`)
- **Donors**: `GET, POST /donors`, `GET /donors/{id}`
- **Offerings**: `GET, POST /offerings`
- **Receipts**: `GET, POST /receipts`
- **Fund Types**: `GET, POST /fund-types`
- **Statistics**: `GET /statistics/offerings-summary`, `GET /statistics/donor-summary`

#### 확장 멤버 API (`/api/v1/members/`)
- **Enhanced Member**: `GET /{id}/enhanced` - 모든 관련 정보를 포함한 멤버 조회
- **Contacts**: `GET, POST /{id}/contacts`
- **Ministries**: `GET, POST /{id}/ministries`
- **Sacraments**: `GET, POST /{id}/sacraments`
- **Transfers**: `GET, POST /{id}/transfers`
- **Codes**: `GET, POST /codes`

### 3. 주요 기능 개선 사항

#### A. 교인 정보의 체계화
- **기존**: 단순한 기본 정보만 저장
- **개선**: 생애주기별, 사역별, 관계별 상세 정보 관리

#### B. 재정 투명성 강화
- **기존**: 재정 관리 기능 없음
- **개선**: 헌금 추적, 영수증 발급, 통계 분석 가능

#### C. 개인정보보호 강화
- 주민등록번호 암호화 저장
- 영수증 발급 시점의 정보 스냅샷으로 개인정보 변경에도 대응

#### D. 감사 및 추적성 향상
- 모든 중요 작업의 변경 이력 추적
- 입력자 정보 기록으로 책임 관리

## 데이터 마이그레이션 전략

### 1. 기존 데이터 유지
- 기존 `members` 테이블의 데이터는 그대로 유지
- 새로운 필드들은 `NULL` 허용으로 설정하여 호환성 보장

### 2. 점진적 데이터 보완
- 새로운 필드들은 사용자가 필요에 따라 점진적으로 입력
- 기존 연락처 정보는 `MemberContact`로 마이그레이션 스크립트 작성 필요

### 3. 재정 데이터 신규 구축
- 재정 관리는 새로운 기능이므로 신규 구축
- 필요시 Excel 등에서 기존 헌금 데이터 일괄 임포트 기능 제공

## 보안 고려사항

### 1. 개인정보보호
- 주민등록번호는 반드시 암호화하여 저장
- 영수증 출력 시에만 복호화하여 마스킹 처리

### 2. 접근 권한 관리
- 재정 정보는 교회 관리자와 재정 담당자만 접근
- 교인 개인정보는 역할 기반으로 접근 제한

### 3. 감사 로그
- 민감한 정보 접근 시 모든 활동 로그 기록
- 정기적인 접근 로그 검토 체계 필요

## 활용 방안

### 1. 교회 운영 효율화
- 체계적인 교인 관리로 목회 효율성 증대
- 재정 투명성으로 교회 신뢰도 향상

### 2. 데이터 기반 의사결정
- 헌금 통계를 통한 재정 계획 수립
- 교인 현황 분석을 통한 목회 전략 수립

### 3. 법적 요구사항 충족
- 기부금 영수증 발급 의무 이행
- 개인정보보호법 준수

## 향후 개발 계획

### 1. 단계별 구현
1. **1단계**: 기본 모델 및 API 구현 (완료)
2. **2단계**: 프론트엔드 UI 개발
3. **3단계**: 데이터 마이그레이션 도구 개발
4. **4단계**: 보고서 및 통계 기능 고도화

### 2. 추가 기능 검토
- 자동 백업 및 복구 시스템
- 모바일 앱에서의 재정 정보 조회 (권한별)
- 외부 회계 시스템과의 연동
- AI 기반 헌금 패턴 분석

## 결론

이번 확장을 통해 Smart Yoram은 단순한 교인 관리 시스템에서 종합적인 교회 관리 시스템으로 발전하였습니다. 특히 재정 관리 기능의 추가로 교회 운영의 투명성과 효율성이 크게 향상될 것으로 기대됩니다.

체계적인 데이터 구조와 세분화된 권한 관리를 통해 한국 개신교회의 특성에 맞는 맞춤형 솔루션을 제공할 수 있게 되었으며, 향후 지속적인 기능 개선을 통해 더욱 완성도 높은 시스템으로 발전시켜 나갈 계획입니다.